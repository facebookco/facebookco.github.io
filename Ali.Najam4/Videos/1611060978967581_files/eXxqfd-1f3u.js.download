if (self.CavalryLogger) { CavalryLogger.start_js(["wbKm1"]); }

__d("MTaggingCounterEvent",[],(function a(b,c,d,e,f,g){f.exports={GEO_PANEL_LOAD:"geo_panel_load",GEO_PANEL_ACCEPT:"geo_panel_accept",GEO_PANEL_DENY:"geo_panel_deny",GEO_PANEL_FAIL:"geo_panel_fail",GEO_PANEL_SUCCESS:"geo_panel_success",GEO_POPUP_LOAD:"geo_popup_load",GEO_POPUP_FAIL:"geo_popup_fail",GEO_POPUP_SUCCESS:"geo_popup_success"};}),null);
__d("XTaggingCounterController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/composer\/tagging\/counter\/",{event:{type:"Enum",required:true,enumType:1}});}),null);
__d('MTaggingCounter',['AsyncSignal','XTaggingCounterController'],(function a(b,c,d,e,f,g,h,i){var j={logEvent:function k(event,l){var m=i.getURIBuilder().setEnum('event',event).getURI();new h(m).send();}};f.exports=j;}),null);
__d('isEmpty',['invariant'],(function a(b,c,d,e,f,g,h){'use strict';function i(k){if(Array.isArray(k)){return k.length===0;}else if(typeof k==='object'){if(k){!j(k)||k.size===undefined||h(0);for(var l in k)return false;}return true;}else return !k;}function j(k){if(typeof Symbol==='undefined')return false;return k[typeof Symbol==='function'?Symbol.iterator:'@@iterator'];}f.exports=i;}),18);
__d('MFeedAdsGapRuleViolationDetection',['Banzai','BanzaiODS','CSS','DataAttributeUtils','DOM','ge','isEmpty'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n){var o='ei',p='qid',q='gap rule violation',r='non violating ads gap',s='non violating ego gap',t='first position violation',u='feed load',v='spacing invalidation',w='ego_pymk',x='ego_other',y=[],z=[],aa=[],ba=[],ca={},da={},ea={},fa=[],ga={registerFeedStories:function ha(ia){var ja=m(ia.containerID);if(ja==null||ja.childNodes==null)return;ca=babelHelpers['extends']({},ia.demoAdChecks,ca);ea=ia.egoGapRule;fa=ia.invalidateEgo?ia.egoStories:{};var ka=this._getStoriesFromContainer(ja);if(ia.isLoggingEnabled&&ka.length!==0)this._logFeedLoad();y=y.concat(ka);for(var la in ia.minGaps)if(Object.prototype.hasOwnProperty.call(ia.minGaps,la))da[la]=ia.minGaps[la];if(n(ca)){if(ia.isLoggingEnabled)this._checkFirstPosViolation(ia,ja);if(ia.invalidateEgo||ia.isLoggingEnabled||ia.isGapRuleInvalidationEnabled)this._checkGapRuleViolation(ia);}},_getStoriesFromContainer:function ha(ia){var ja=[];for(var ka=0;ka<ia.childNodes.length;ka++){var la=this._convertStoryNodeToObject(ia.childNodes[ka]);if(la!==null)ja.push(la);}return ja;},_convertStoryNodeToObject:function ha(ia){var ja=ia.getAttribute('data-dedupekey'),ka=[k.getDataFt(ia)];if(ka[0]==null)return null;var la=JSON.parse(ka[0]);return {dataFTArray:ka,dedupKey:ja,isSponsored:!!la[o],isEgoPymk:fa[ja]===w,isEgoOther:fa[ja]===x,height:ia.offsetHeight,qid:parseInt(la[p],10),nodeID:ia.id};},_checkFirstPosViolation:function ha(ia,ja){if(y.length>0&&y[0].isSponsored){var ka={ftArray:y[0].dataFTArray,qid:y[0].qid,nodeid:y[0].nodeID};if(ia.isLoggingEnabled&&!(y[0].dedupKey in ba)){this._logFirstPosViolation(ka);ba[y[0].dedupKey]=ka;}}},_getMinGap:function ha(ia,ja,ka){var la=Math.min(ia?ia:Number.MAX_VALUE,ja?ja:Number.MAX_VALUE);return la!==Number.MAX_VALUE?la:ka;},_getStoryDedupKeysJSONString:function ha(ia,ja){var ka=[];for(var la=ia;la<=ja;la++)ka.push(y[la].dedupKey);return JSON.stringify(ka);},_getStoryDedupKeys:function ha(){return y.map(function(ia){return ia.dedupKey;});},_checkGapRuleViolation:function ha(ia){var ja=null,ka=null,la=null;for(var ma=0;ma<y.length;ma++){var na=y[ma];if(na.isSponsored){var oa=false,pa=false;if(ja!==null){var qa=ma-ka,ra=null,sa=null;if(ja===ka){sa=this._getMinGap(da[la.dedupKey],da[na.dedupKey],ia.defaultMinGap);}else sa=this._getMinGapBetweenStories(la,na);var ta=null;if(qa<sa){ra=q;ta=ka;}else{ra=r;ta=ja;}if(ia.isLoggingEnabled)if(!(na.dedupKey in z)||z[na.dedupKey].event_type!==ra){this._logGapEvent(ra,ta,ma);z[na.dedupKey]={event_type:ra};}if(ia.isGapRuleInvalidationEnabled&&ra==q){this._invalidateGapRuleViolatedAd(la,na);oa=true;y.splice(ma--,1);}}if(!oa&&!pa){ja=ma;ka=ma;la=na;}}if(ia.invalidateEgo&&(na.isEgoPymk||na.isEgoOther)){var ua=false;if(ka!==null){qa=ma-ka;sa=this._getMinGapBetweenStories(la,y[ma]);if(qa<sa){ua=true;var va=sa-qa,wa=-1;for(var xa=ma+1;xa<y.length;xa++){if(y[xa].isSponsored||y[xa].isEgoPymk||y[xa].isEgoOther){break;}else va--;if(va===0){wa=xa;break;}}if(wa>0){this._swapAndLogEgo(ma,xa);}else{this._invalidateAndLogEgo(ma);ma--;}}else if(ia.shouldLogEgo&&!aa[na.dedupKey]){aa[na.dedupKey]=true;this._logGapEvent(s,ka,ma);}}if(!ua){ka=ma;la=na;}}}},_getMinGapBetweenStories:function ha(ia,ja){var ka='';if(ia.isSponsored||ia.isEgoOther){ka='ad';}else if(ia.isEgoPymk){ka='pymk';}else return 0;var la='';if(ja.isSponsored||ja.isEgoOther){la='ad';}else if(ja.isEgoPymk){la='pymk';}else return 0;return ea[ka+'_'+la];},_swapAndLogEgo:function ha(ia,ja){this._shiftEgoBelowOrganicStory(y[ia].nodeID,y[ja].nodeID);var ka=y[ia];y.splice(ia,1);y.splice(ja,0,ka);i.bumpEntityKey('m_feed_ego_invalidation','swap');},_shiftEgoBelowOrganicStory:function ha(ia,ja){var ka=m(ia),la=m(ja);ka&&la&&l.insertAfter(la,ka);},_invalidateAndLogEgo:function ha(ia){var ja=m(y[ia].nodeID);ja&&j.hide(ja);y.splice(ia,1);i.bumpEntityKey('m_feed_ego_invalidation','invalidate');},_logFirstPosViolation:function ha(ia){var ja={ft:ia.ftArray[0],event_type:t,intValues:{qid:ia.qid}};if(ia.error_msg)ja.error_msg=ia.error_msg;h.post('feed_ads_gap_rule_violation',ja);},_logGapEvent:function ha(ia,ja,ka){if(ja===null)return;var la=y[ja],ma=y[ka],na=0;for(var oa=ja+1;oa<ka;oa++)na+=y[oa].height;var pa={ft_A:la.dataFTArray[0],ft_B:ma.dataFTArray[0],event_type:ia,intValues:{dist:ka-ja,pdist:na,pos:ka+1,qid_A:la.qid,qid_B:ma.qid},strValues:{previous_unit_type:this._getUnitTypeForLogging(la),unit_type:this._getUnitTypeForLogging(ma)},dedup_keys:this._getStoryDedupKeysJSONString(ja,ka)};h.post('feed_ads_gap_rule_violation',pa);},_getUnitTypeForLogging:function ha(ia){if(ia.isSponsored){return 'ad';}else if(ia.isEgoPymk){return 'pymk';}else if(ia.isEgoOther)return 'ego_other';return null;},_logFeedLoad:function ha(){var ia={event_type:u};h.post('feed_ads_gap_rule_violation',ia);},_invalidateGapRuleViolatedAd:function ha(ia,ja){var ka=m(ja.nodeID);ka&&j.hide(ka);var la={ft_array_A:ia.dataFTArray[0],ft_array_B:ja.dataFTArray[0],event_type:v};h.post('feed_ads_gap_rule_violation',la);}};f.exports=ga;}),null);
__d('MFeedErrorDetection',['Banzai','DataAttributeUtils'],(function a(b,c,d,e,f,g,h,i){'use strict';var j={};function k(event,m,n,o){var p={event:event,shouldLogDetail:m,site:'mtouch'};if(m){p.intValues=n;p.normalValues=o;}h.post('feed_error_detection',p,{delay:0});}var l={registerFeedStory:function m(n){var o=n.feedObjectElement,p=n.shouldLogDetail;if(!o)return;var q=i.getDataFt(o),r=o.getAttribute('data-dedupekey');if(!r||!q)return;if(j[r]){var s=void 0;if(p)s={dedupKey:r,ft_A:q,ft_B:j[r]};k('mtouch_duplicate_stories',p,{},{dup_field:s||{}});}else j[r]=q;}};f.exports=l;}),null);
__d('ViewportTrackingHooks',['Base64'],(function a(b,c,d,e,f,g,h){var i={},j=[],k={registerFeedObject:function l(m,n){i[m]=h.encode(n);},updateVisibleViewportObjects:function l(m){var n=[],o=false;for(var p=0;p<m.length;p++){var q=m[p],r=q.id;while(!(r in i)&&q.firstChild!=undefined&&q.firstChild.id!=undefined&&q.firstChild.id.startsWith("u_")){r=q.firstChild.id;q=q.firstChild;}if(r in i){n.push(i[r]);if(!(p in j)||j[p]!=i[r])o=true;}}if(!o&&j.length!=n.length)o=true;if(o){j=n;if(typeof __EXT__updateVisibleViewportObjects==='function')__EXT__updateVisibleViewportObjects(j);}}};f.exports=k;}),null);
__d('MViewportTracking',['DataAttributeUtils','DOM','FBJSON','MViewport','Stratcom','Style','Vector','ViewportTrackingHooks','Visibility','invariant','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){'use strict';var s=97,t=200;function u(){this.$MViewportTracking2=[];this.debugConsole=false;this.activeStories={};this.cachedViewportHeight=0;this.discardVPVDIntervalThreshold=90000;this.isLoose=false;this.isTimeTrackingEnabled=false;this.latestTimeTrackingTimestamp=0;this.maxScrollPosition=0;this.minSizeToBeVisible=0;this.readStoryIDs={};this.relaxedMinSize=false;this.throttleNoDelay=false;this.trackingHooks=false;this.vpvdDebug=false;this.vpvDebug=false;}u.prototype.getDataFromConfig=function(v){q(0);};u.prototype.getStoryID=function(v){q(0);};u.prototype.getDataToLog=function(v){q(0);};u.prototype.sendDataToLog=function(v){q(0);};u.prototype.getTimeout=function(){q(0);};u.prototype.getAllStories=function(){q(0);};u.prototype.init=function(v){this.isLoose=!!v.is_loose;this.throttleNoDelay=!!v.throttle_no_delay;this.relaxedMinSize=!!v.relaxed_min_size;this.vpvDebug=!!v.vpv_debug;this.trackingHooks=!!v.tracking_hooks;this.isTimeTrackingEnabled=false;this.cachedViewportHeight=k.getHeight();this.getDataFromConfig(v);this.maxScrollPosition=0;this.readStoryIDs={};this.$MViewportTracking2=[l.listen('m:page:unload',null,this.onUnload.bind(this)),l.listen('m:viewport:update-complete',null,function(){this.cachedViewportHeight=k.getHeight();}.bind(this))];if(v.triggerOverride){this.$MViewportTracking2=this.$MViewportTracking2.concat(v.triggerOverride.map(function(w){var event=w[0],x=w[1];return l.listen(event,x,this.queueLogAction.bind(this));}.bind(this)));}else this.$MViewportTracking2.push(l.listen('scroll',null,this.queueLogAction.bind(this)));if(this.isTimeTrackingEnabled){this.$MViewportTracking2.push(p.addListener(p.VISIBLE,function(){return this.startRecordingTimeTrackingData();}.bind(this)));this.$MViewportTracking2.push(p.addListener(p.HIDDEN,function(){return this.stopRecordingTimeTrackingData();}.bind(this)));}this.fireEvent();};u.prototype.getFBFeedLocation=function(){return -1;};u.prototype.unitTestOnlyGetListeners=function(){return [].concat(this.$MViewportTracking2);};u.prototype.getMinSizeToBeVisible=function(v){if(!this.relaxedMinSize)return t;var w='getBoundingClientRect' in v?v.getBoundingClientRect().height:n.getDim(v).y;return Math.min(t,w*.5);};u.prototype.fireEvent=function(){var v=this.getAllStoriesInView();for(var w=0;w<v.length;w++){var x=v[w],y=this.getStoryID(x);if(!y||y in this.readStoryIDs)continue;this.readStoryIDs[y]=true;this.sendDataToLog(this.getDataToLog(x));if(this.vpvDebug){var z=i.scry(x,'div')[0];if(z)m.set(z,'background-color','#fffbe2');}this.markStoryRead(x);}if(this.trackingHooks)o.updateVisibleViewportObjects(this.getAllStoriesInView(true));};u.prototype.markStoryRead=function(v){};u.prototype.queueLogAction=function(){if(this.isLoose){if(!this.$MViewportTracking3)this.$MViewportTracking3=r(function(){if(this.isTimeTrackingEnabled)this.startRecordingTimeTrackingData();this.$MViewportTracking3=null;this.maxScrollPosition=Math.max(this.maxScrollPosition,k.getScrollTop());if(!this.throttleNoDelay){clearTimeout(this.$MViewportTracking1);this.$MViewportTracking1=r(function(){return this.fireEvent();}.bind(this),this.getTimeout());}else this.fireEvent();}.bind(this),100);}else{clearTimeout(this.$MViewportTracking1);this.$MViewportTracking1=r(function(){if(this.isTimeTrackingEnabled)this.startRecordingTimeTrackingData();this.fireEvent();}.bind(this),this.getTimeout());}};u.prototype.getTimetrackingDataToLog=function(v){var w=i.scry(v.story,'*','data-is-cta').map(function(x){var y=h.getDataFt(x),z=y&&JSON.parse(y);return z&&z.cta_types;}).filter(function(x){return !!x;});return {evt:s,fbfeed_location:this.getFBFeedLocation(),story_height:v.story_height,viewport_height:this.cachedViewportHeight,vpvd_start_timestamp:v.evp_ts/1000,vpvd_time_delta:Math.round(v.vpvd||0),cta_types:w};};u.prototype.recordTimeStoryWasInView=function(v){if(this.isTimeTrackingEnabled&&v.vpvd>0){var w=this.getTimetrackingDataToLog(v);if(typeof w!=='string'){var x=h.getDataFt(v.story);if(x)w=babelHelpers['extends']({},w,j.parse(x,f.id));}this.sendTimetrackingDataToLog(w);}};u.prototype.startRecordingTimeTrackingData=function(){this.$MViewportTracking4(false);};u.prototype.stopRecordingTimeTrackingData=function(){this.$MViewportTracking4(true);};u.prototype.$MViewportTracking4=function(v){if(!this.activeStories)this.activeStories={};var w=Date.now();if(!this.latestTimeTrackingTimestamp)this.latestTimeTrackingTimestamp=w;var x=this.getAllStoriesInView();this.updateVPVDurations(w);if(this.debugConsole){var y=Object.values(this.activeStories);if(y.length)console.table&&console.table(y);}var z=this.updateActiveStories(x,w);if(this.debugConsole)if(z.length)console.table&&console.table(z);this.recordVPVDurations(x,v);this.latestTimeTrackingTimestamp=v?0:w;};u.prototype.updateVPVDurations=function(v){var w=v-this.latestTimeTrackingTimestamp;if(w>this.discardVPVDIntervalThreshold)return;var x=v-this.latestTimeTrackingTimestamp;for(var y in this.activeStories)if(Object.prototype.hasOwnProperty.call(this.activeStories,y))this.activeStories[y].vpvd+=x;};u.prototype.isVisible=function(v,w){for(var x=0;x<w.length;x++)if(this.getStoryID(w[x])===v)return true;return false;};u.prototype.recordVPVDurations=function(v,w){this.recordVPVDurationsInternal(v,w);};u.prototype.recordVPVDurationsInternal=function(v,w){for(var x in this.activeStories)if(Object.prototype.hasOwnProperty.call(this.activeStories,x))if(w||!this.isVisible(x,v)){this.recordTimeStoryWasInView(this.activeStories[x]);delete this.activeStories[x];}};u.prototype.updateActiveStories=function(v,w){var x=[];for(var y=0;y<v.length;y++){var z=this.getStoryID(v[y]);if(!z)break;if(!(z in this.activeStories)){this.activeStories[z]={evp_ts:w,story:v[y],vpvd:0,story_height:v[y].offsetHeight};x.push(this.activeStories[z]);}this.activeStories[z].ts=w;}return x;};u.prototype.getAllStoriesInView=function(){var v=arguments.length<=0||arguments[0]===undefined?false:arguments[0],w=[],x=this.getAllStories(),y=k.getScrollTop(),z=k.getHeight(),aa=this.isLoose,ba=z+this.maxScrollPosition-y;for(var ca=0;ca<x.length;ca++){var da=x[ca],ea=this.getStoryBounds(y,da),fa=ea.top,ga=ea.bottom;if(!fa&&!ga)continue;var ha=this.getMinSizeToBeVisible(da);if(!aa&&fa>z-ha)break;var ia=!aa&&fa<=z-ha&&ga>=ha||aa&&fa<ba;if(v&&(ga<0||fa>z))ia=false;if(ia)w.push(da);}return w;};u.prototype.getStoryBounds=function(v,w){if('getBoundingClientRect' in w){var x=w.getBoundingClientRect();return {bottom:x.bottom,top:x.top};}else{var y=n.getPos(w).y-v;return {top:y,bottom:y+n.getDim(w).y};}};u.prototype.cleanup=function(){this.$MViewportTracking2.forEach(function(v){return v.remove();});this.$MViewportTracking2=[];};u.prototype.onUnload=function(){if(this.isTimeTrackingEnabled)this.stopRecordingTimeTrackingData();this.cleanup();};u.prototype.sendTimetrackingDataToLog=function(v){this.sendDataToLog(v);};f.exports=u;}),null);
__d('MCommentViewportTracking',['Banzai','DataStore','DOM','FBJSON','MParent','MViewportTracking','Stratcom','StratcomManager','compactArray'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';var q,r,s=null,t={m_group_stories_container:'group',m_newsfeed_stream:'',m_story_permalink_view:'',structured_composer_async_container:'user',root:''};q=babelHelpers.inherits(u,m);r=q&&q.prototype;u.loadedReplies=function(){n.invoke('m:commentViewportTracking:loadedReplies');};u.singleton=function(v){if(!s){v.triggerOverride=[['scroll',null],['m:commentViewportTracking:loadedReplies',null],['m:feed-ufi-flyout:comments-displayed',null]];o.enableDispatch(document,'scroll');s=new u();s.init(v);s.debugConsole;n.listen('m:page:unload',null,function(){s=null;n.removeCurrentListener();});}};u.registerFlyout=function(v,w){var x;if(s){s.debugConsole;s.streamRoot=v;}t=babelHelpers['extends']((x={},x[v.id]=w||'',x),t);};u.prototype.getDataFromConfig=function(v){this.debugConsole=v.debug_console;this.isTimeTrackingEnabled=true;this.idle_timeout=v.idle_timeout;this.min_duration_to_log=v.min_duration_to_log;this.min_visible_size=v.min_visible_size;};u.prototype.__getRootNode=function(){if(!this.streamRoot)this.streamRoot=p(Object.keys(t).map(function(v){return document.getElementById(v);}))[0]||null;return this.streamRoot;};u.prototype.getAllStories=function(){var v=this.__getRootNode();if(!v)return [];return j.scry(this.__getRootNode(),'div','comment-body');};u.prototype.getTimeout=function(){return this.min_duration_to_log;};u.prototype.getDataToLog=function(v){return {};};u.prototype.getStoryID=function(v){var w=v.getAttribute('data-commentid');if(!w)return String(i.get(v,'token'))||null;return w;};u.prototype.getContainerModule=function(){var v=this.__getRootNode();if(!v||!(v.id in t))return 'other';return t[v.id];};u.prototype.getTimetrackingDataToLog=function(v){var w=v.story,x=void 0;try{var y=l.bySigil(v.story,'story-div')||l.bySigil(v.story,'m-feed-single-story');if(y)x=k.parse(y.getAttribute('data-ft'),f.id);}catch(z){}return {comment_id:this.getStoryID(w),duration_ms:Math.round(v.vpvd),container_module:this.getContainerModule(),mf_story_key:x?x.mf_story_key||x.top_level_post_id:null};};u.prototype.sendDataToLog=function(v){if(v.comment_id){this.debugConsole;h.post('comment_vpvd',v);}};function u(){q.apply(this,arguments);}f.exports=u;}),null);
__d("Tooltip",[],(function a(b,c,d,e,f,g){var h={propsFor:function i(j){return;}};f.exports=h;}),null);
__d('MSnowflakeLink',['DataAttributeUtils','DOM','MModalDialog','URI','MLinkHack','Parent','Stratcom','destroyOnUnload'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(q){'use strict';this.$MSnowflakeLink1=false;this.$MSnowflakeLink2=q.node;this.$MSnowflakeLink3=q.permalink;this.$MSnowflakeLink4=q.setToken;this.$MSnowflakeLink5=q.targetPhoto;this.$MSnowflakeLink6=i.listen(q.node,'click',null,this.onClick.bind(this));o(function(){return this.$MSnowflakeLink6.remove();}.bind(this));this.$MSnowflakeLink7();}p.prototype.getFeedTrackingOwnerID=function(){'use strict';var q=h.getClickTrackingParent(this.$MSnowflakeLink2);return q&&q.id;};p.prototype.getPermalinkURI=function(){'use strict';return new k(this.$MSnowflakeLink3).addQueryData('photo_id',this.$MSnowflakeLink5);};p.prototype.getModalDialogURI=function(){'use strict';return new k(this.$MSnowflakeLink2.getAttribute('href')).addQueryData('cached_data',this.$MSnowflakeLink1).addQueryData('ftid',this.getFeedTrackingOwnerID());};p.prototype.onClick=function(q){'use strict';l.remove(this.$MSnowflakeLink2);j.openWithPermalinkURI(this.getModalDialogURI().toString(),this.getPermalinkURI());q.kill();};p.prototype.$MSnowflakeLink7=function(){'use strict';if(!this.$MSnowflakeLink4){this.$MSnowflakeLink1=true;return;}var q=n.listen('m:photosetstore:update',null,function(event){var r=(event.getData()||{}).set_token;if(!q||r!=this.$MSnowflakeLink4)return;this.$MSnowflakeLink1=true;q.remove();q=null;}.bind(this));o(function(){return q&&q.remove();});};f.exports=p;}),null);
__d('MShareAngoraAttachment',['Stratcom'],(function a(b,c,d,e,f,g,h){var i=false,j=function k(l){if(i)return;i=true;window.addEventListener('error',function(event){if(event.target.nodeName=='IMG'){for(var m=event.target;m!=document.body&&!h.hasSigil(m,'shareAngoraAttachmentMedia');m=m.parentNode);if(m!=document.body)m.style.display='none';}},true);};g.registerDeadImageListener=j;}),null);
__d('MExposeMore',['CSS','DOM','Stratcom'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k=[];function l(){while(k.length)k.pop().remove();}var m='expose';j.listen('click',[m,'more'],function(event){var o=event.getNode(m);h.conditionClass(o,'text_exposed',true);event.prevent();});var n={showMessageSuffixOnClick:function o(p,q){if(q.children.length!==0){if(!k.length)k.push(j.listen('m:page:unload',null,l));var r=i.scry(p,'*','more')[0];if(r)k.push(i.listen(r,'click',null,function(event){h.show(q);event.prevent();}));}}};f.exports=n;}),null);
__d('MLocationPrompt',['DOM','MRequest','Stratcom','WebStorage','XPlacesUpdateLocationController','MTaggingCounter','MTaggingCounterEvent','ViewerLocationSource'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=['latitude','longitude','accuracy','altitude','altitudeAccuracy','heading','speed'],q={enableHighAccuracy:true,timeout:60000,maximumAge:300000},r=60000;s.init=function(t,u,v,w){'use strict';return new s(t,u,v,w);};s.getCoords=function(){'use strict';return s.coords;};s.isLocationAvailable=function(){'use strict';return s.locationAvailable;};function s(t,u,v,w){'use strict';this.lastUpdateTime=0;this.container=t;this.question=u;this.loading=v;this.errored=w;var x=k.getLocalStorage();if(x&&x.getItem(s.GEOLOCATION_KEY)==='1'){this.$MLocationPrompt1();}else{s.locationAvailable=false;h.show(this.question);h.hide(this.loading);h.hide(this.errored);h.show(this.container);j.invoke('m:jewel-set:notifications-jewel:refresh-flyout');m.logEvent(n.GEO_PANEL_LOAD);}this.listeners=[j.listen('click','accept-location',this.$MLocationPrompt2.bind(this)),j.listen('click','deny-location',this.$MLocationPrompt3.bind(this)),j.listen('m:page:unload',null,this.$MLocationPrompt4.bind(this))];}s.prototype.clearWatch=function(){'use strict';if(!this.watchID)return;navigator.geolocation.clearWatch(this.watchID);this.watchID=null;};s.prototype.$MLocationPrompt2=function(){'use strict';m.logEvent(n.GEO_PANEL_ACCEPT);this.$MLocationPrompt1(true);};s.prototype.$MLocationPrompt1=function(t){'use strict';s.locationAvailable=true;var u=k.getLocalStorage();if(u)u.setItem(s.GEOLOCATION_KEY,"1");h.show(this.container);h.hide(this.question);h.show(this.loading);h.hide(this.errored);j.invoke('m:jewel-set:notifications-jewel:refresh-flyout');var v=setTimeout(this.$MLocationPrompt5,q.timeout);this.watchID=navigator.geolocation.watchPosition(function(w){if(t)m.logEvent(n.GEO_PANEL_SUCCESS);clearTimeout(v);this.$MLocationPrompt6(w);}.bind(this),function(w){if(t)m.logEvent(n.GEO_PANEL_FAIL);clearTimeout(v);this.$MLocationPrompt5(w);}.bind(this),q);j.invoke(s.STRATCOM_ACCEPT);};s.prototype.$MLocationPrompt3=function(){'use strict';s.locationAvailable=false;m.logEvent(n.GEO_PANEL_DENY);h.hide(this.container);j.invoke('m:jewel-set:notifications-jewel:refresh-flyout');j.invoke(s.STRATCOM_DENY);};s.prototype.$MLocationPrompt6=function(t){'use strict';s.locationAvailable=true;if(t){var u={},v;for(var w=0;w<p.length;w++){v=p[w];if(t.coords[v])u[v]=t.coords[v];}if(t.timestamp)u.timestamp=t.timestamp/1000;this.$MLocationPrompt7(JSON.stringify(u));h.hide(this.container);s.coords=u;j.invoke('m:jewel-set:notifications-jewel:refresh-flyout');j.invoke(s.STRATCOM_UPDATE,null,{position:t});}};s.prototype.$MLocationPrompt5=function(t){'use strict';s.locationAvailable=false;this.clearWatch();var u=k.getLocalStorage();if(u)u.setItem(s.GEOLOCATION_KEY,"0");h.show(this.container);h.hide(this.question);h.hide(this.loading);h.show(this.errored);j.invoke('m:jewel-set:notifications-jewel:refresh-flyout');j.invoke(s.STRATCOM_FAIL,null,{error:t});m.logEvent(n.GEO_PANEL_FAIL);};s.prototype.$MLocationPrompt7=function(t){'use strict';var u=Date.now();if(u-this.lastUpdateTime>r){this.lastUpdateTime=u;var v=l.getURIBuilder().setString('json_location',t).setEnum('source',o.MSITE_LOCATION_PROMPT).getURI();new i(v).setMethod('POST').send();}};s.prototype.$MLocationPrompt4=function(){'use strict';if(!this.listeners)return;for(var t=0;t<this.listeners.length;t++)this.listeners[t].remove();this.listeners=[];};Object.assign(s,{STRATCOM_ACCEPT:'MLocationPrompt/accept',STRATCOM_DENY:'MLocationPrompt/deny',STRATCOM_UPDATE:'MLocationPrompt/update',STRATCOM_FAIL:'MLocationPrompt/fail',GEOLOCATION_KEY:'authorizeGeolocation',locationAvailable:undefined});f.exports=s;}),null);
__d('MMoreItemAutomatic',['MLocationPrompt','MPageCache','MPageControllerPath','MRequest','MRequestGateway','MRequestTypes','MResponseData','MStopNGo','MURI','MViewport','Stratcom','Vector','createDeprecatedProperties','throttle'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){function v(w){'use strict';this._onScrollPrefetch=function(){if(this._insertWhileScrolling){this._onGo();}else if(!this._itemsLoaded&&!this._requestSent)this._sendRequestIfScrolledDown();}.bind(this);this._href=w.href;this._sendGeolocation=w.sendGeolocation;this._proximityPages=w.proximity_pages||7;this._loggerID=w.logger_id;this._loggerName=w.logger_name;this._loadImmediately=w.load_first_immediately;this._retryOnError=w.retryOnError;this._addToCache=w.addToCache;this._alwaysProcess=w.alwaysProcess;this._scrollPrefetchThrottleFreq=w.scrollPrefetchThrottleFreq||0;this._insertWhileScrolling=w.insertWhileScrolling;var x=document.getElementById(w.id);if(x){this._verticalOffset=s.getPos(x).y;this.setMoreItem(x);this.setPersistOnReload(w.persist_on_reload);this._setUpSendRequest();}else this.uninstall();}v.prototype.isElementVisible=function(){'use strict';if(!this._isElementRendered())return false;var w,x=this.getMoreItem();if('getBoundingClientRect' in x){var y=x.getBoundingClientRect(),z=y.width/10,aa=y.height/10,ba=y.left,ca=y.right,da=y.top,ea=y.bottom,fa;while(fa!==x&&ba<=ca&&da<=ea){ba+=z;da+=aa;fa=document.elementFromPoint(Math.round(ba),Math.round(da));}w=fa===x;}else{var ga=s.getPos(x).y,ha=ga+s.getDim(x).y,ia=q.getScrollTop(),ja=ia+q.getUseableHeight();w=ga<=ja&&ha>=ia;}return w;};v.prototype._checkScrolledIntoFetched=function(){'use strict';var w=this.getMoreItem();if(w)if(this._verticalOffset-q.getScrollTop()<0){r.invoke('m:more_item_automatic:items_visible',this._loggerID);this.uninstall();}};v.prototype._onGo=function(){'use strict';if(!this._itemsLoaded){this._readyToUpdate=true;if(this.isElementVisible())r.invoke('m:more_item_automatic:spinner_visible',this._loggerID);if(!this._requestSent){this._sendRequestIfScrolledDown();}else this._updateItems();}else this._checkScrolledIntoFetched();};v.prototype._onStop=function(){'use strict';if(!this._itemsLoaded)this._readyToUpdate=false;};v.prototype._onAjaxPageLoad=function(){'use strict';if(!this._requestSent&&(this._loadImmediately||this.isElementVisible())){this._sendRequest();this._loadImmediately=false;}};v.prototype._setUpSendRequest=function(){'use strict';if(!this._requestSent&&(this._loadImmediately||this.isElementVisible())){this._sendRequest();this._loadImmediately=false;}this._listeners=[];if(this._scrollPrefetchThrottleFreq>0)this._listeners.push(r.listen(['m:page:render:complete','scroll'],null,u.withBlocking(this._onScrollPrefetch,this._scrollPrefetchThrottleFreq,this)));if(!this._insertWhileScrolling)this._listeners.push(o.listen('go',this._onGo.bind(this)),o.listen('stop',this._onStop.bind(this)));this._listeners.push(r.listen('m:ajax:complete',null,this._onAjaxPageLoad.bind(this)));};v.prototype._existsOnPage=function(){'use strict';var w=this.getMoreItem();return w?document.documentElement.contains(w):false;};v.prototype.uninstall=function(){'use strict';while(this._listeners&&this._listeners.length)this._listeners.pop().remove();this._requestSent=false;this._prefetchResponse=null;this.setMoreItem(null);this.setPersistOnReload(false);clearTimeout(this._retryTimeout);clearTimeout(this._sendTimeout);};v.prototype.withinProximity=function(){'use strict';var w=this.getMoreItem();return w&&s.getPos(w).y-q.getScrollTop()<q.getUseableHeight()*(1+this._proximityPages);};v.prototype._updateItems=function(){'use strict';if(this._prefetchResponse){if(this._existsOnPage()){this._prefetchResponse.process();if(this._addToCache)i.addCachedIUIResponse(j.getRequestPath(),this._prefetchResponse);}r.invoke('m:more_item_automatic:items_loaded',this._loggerID);this._itemsLoaded=true;}};v.prototype._isElementRendered=function(){'use strict';var w=this.getMoreItem();if(!w||!w.offsetHeight)return false;return true;};v.prototype._sendRequestIfScrolledDown=function(){'use strict';if(this.isElementVisible()||this._isElementRendered()&&q.getScrollTop()>100&&this.withinProximity())this._sendRequest();};v.prototype._sendRequest=function(){'use strict';var w=h.getCoords();if(this._sendGeolocation&&w)this._href=new p(this._href).addQueryData('lat',w.latitude).addQueryData('long',w.longitude).toString();var x=new k(new p(this._href).toString());if(this._alwaysProcess){x.setType(m.INDEPENDENT);}else x.setType(m.DEPENDENT);x.setAutoProcess(false);var y=[],z=false,aa=function ba(){if(!z&&y.length){z=true;y.shift().process();}};if(this._retryOnError){x.setTimeout(l.ERROR_TIMEOUT);x.listen('error',function(ba,ca){this._retryTimeout=setTimeout(function(){if(navigator.onLine){ca.reset();ca.addData({is_retry:1});ca.sendAfterProcessing();}}.bind(this),v.TRY_AGAIN_DELAY);});}x.listen('response',function(ba){ba=new n(ba);ba.listen('complete',function(){z=false;aa();});if(ba.isPagelet()){y.push(ba);aa();return;}z=true;this._prefetchResponse=ba;if(this._readyToUpdate)this._updateItems();}.bind(this));x.send();this._requestSent=true;};t(v,{moreItem:null,persistOnReload:false});Object.assign(v.prototype,{_requestSent:false,_readyToUpdate:true,_moreStartTime:0,_moreLogged:false,_proximityPages:null,_prefetchResponse:null,_listeners:null,_href:null,_loggerName:null,_loggerID:null,_itemsLoaded:false,_verticalOffset:0});Object.assign(v,{TRY_AGAIN_DELAY:1500});f.exports=v;}),null);
__d('InitMMoreItemAutomatic',['MMoreItemAutomatic','Stratcom'],(function a(b,c,d,e,f,g,h,i){var j,k=function l(m){if(!j){j={};i.listen('m:page:loading',null,function(o){for(var p in j)if(!j[p].getPersistOnReload()){j[p].uninstall();delete j[p];}});}var n=m.id;if(j[n])j[n].uninstall();j[n]=new h(m);};g.main=k;}),null);
__d('MMoreItemAutomaticLogger',['Stratcom','MarauderLogger'],(function a(b,c,d,e,f,g,h,i){function j(k,l){this._loggerName=k;this._loggerID=l;this._listeners=[h.listen('m:page:unload',null,this._pageUnload.bind(this)),h.listen('m:more_item_automatic:spinner_visible',null,this._onSpinnerVisible.bind(this)),h.listen('m:more_item_automatic:items_loaded',null,this._onItemsLoaded.bind(this)),h.listen('m:more_item_automatic:items_visible',null,this._onItemsVisible.bind(this))];}Object.assign(j.prototype,{_loggerName:'',_loggerID:'',_spinnerUnloaded:false,_spinnerVisible:false,_spinnerStartTime:null,_cleanup:function k(){while(this._listeners&&this._listeners.length)this._listeners.pop().remove();},_pageUnload:function k(){if(this._spinnerVisible){this._spinnerUnloaded=true;this._logLoadingSpinnerTime(this._getTimeSpan(),true);}this._cleanup();},_onSpinnerVisible:function k(event){if(event.getPath()[0]===this._loggerID&&!this._spinnerVisible){this._spinnerVisible=true;this._spinnerStartTime=Date.now();}},_onItemsLoaded:function k(event){if(event.getPath()[0]===this._loggerID&&!this._spinnerUnloaded){this._logLoadingSpinnerTime(this._getTimeSpan(),false);this._spinnerVisible=false;this._spinnerStartTime=null;}},_onItemsVisible:function k(event){if(event.getPath()[0]===this._loggerID)this._logItemsVisible();},_getTimeSpan:function k(){return this._spinnerVisible?Date.now()-this._spinnerStartTime:0;},_logLoadingSpinnerTime:function k(l,m){i.log('m_more_items_automatic_spinner_visible_time',undefined,{name:this._loggerName,id:this._loggerID,visible_time:l,spinner_unloaded:m});},_logItemsVisible:function k(){i.log('m_more_items_automatic_fetched_items_visible',undefined,{name:this._loggerName,id:this._loggerID});this._cleanup();}});j.init=function(k,l){new j(k,l);};f.exports=j;}),null);
__d('MScrollAreaHelper',['MLegacyDataStore'],(function a(b,c,d,e,f,g,h){function i(j,k){k=k||10;var l;while(k>0&&j&&j.nodeType===1){l=h.get(j);if(l&&l.scrollArea)return l.scrollArea;j=j.parentNode;k--;}return null;}g.findScrollArea=i;}),null);